# 集合引用类型

## Object

到目前为止，大多数引用值的示例使用的是 `Object` 类型。`Object` 是 ECMAScript 中最常用的类型之一。虽然 `Object` 的实例没有多少功能，但很适合存储和在应用程序间交换数据。

显式地创建 `Object` 的实例有两种方式。第一种是使用 `new` 操作符和 `Object` 构造函数。另一种方式是使用对象字面量（object literal）表示法。对象字面量是对象定义的简写形式，目的是为了简化包含大量属性的对象的创建。

```js
let person = new Object(); 
person.name = "Nicholas"; 
person.age = 29;

let person = {
    name: "Nicholas",
    age: 29
};
```

在对象字面量表示法中，属性名可以是字符串或数值。

```js
let person = {
    "name": "Nicholas",
    "age": 29,
    5: true
};
```

当然也可以用对象字面量表示法来定义一个只有默认属性和方法的对象，只要使用一对大括号，中间留空就行了。

```js
let person = {}; // 与 new Object()相同相同 
person.name = "Nicholas"; 
person.age = 29;
```

虽然使用哪种方式创建 `Object` 实例都可以，但实际上开发者更倾向于使用对象字面量表示法。这是因为对象字面量代码更少，看起来也更有封装所有相关数据的感觉。事实上，对象字面量已经成为给函数传递大量可选参数的主要方式。

```js
function displayInfo(args) {
    let output = "";

    if (typeof args.name == "string") {
        output += "Name: " + args.name + "\n";
    }

    if (typeof args.age == "number") {
        output += "Age: " + args.age + "\n";
    }

    alert(output);
}

displayInfo({
    name: "Nicholas",
    age: 29
});

displayInfo({
    name: "Greg"
});
```

虽然属性一般是通过点语法来存取的，这也是面向对象语言的惯例，但也可以使用中括号来存取属性。在使用中括号时，要在括号内使用属性名的字符串形式。从功能上讲，这两种存取属性的方式没有区别。使用中括号的主要优势就是可以通过变量访问属性。

```js
let propertyName = "name"; 
console.log(person[propertyName]); // "Nicholas"
```

如果属性名中包含可能会导致语法错误的字符，或者包含关键字/保留字时，也可以使用中括号语法。

```js
person["first name"] = "Nicholas";
```

因为 `"first name"` 中包含一个空格，所以不能使用点语法来访问。不过，属性名中是可以包含非字母数字字符的，这时候只要用中括号语法存取它们就行了。

通常，点语法是首选的属性存取方式，除非访问属性时必须使用变量。

## Array

ECMAScript 数组跟其他编程语言的数组有很大区别。跟其他语言中的数组一样，ECMAScript 数组也是一组有序的数据，但跟其他语言不同的是，数组中每个槽位可以存储任意类型的数据。这意味着可以创建一个数组，它的第一个元素是字符串，第二个元素是数值，第三个是对象。ECMAScript 数组也是动态大小的，会随着数据添加而自动增长。

### 创建数组

有几种基本的方式可以创建数组。一种是使用 `Array` 构造函数。

```js
let colors = new Array();
```

如果知道数组中元素的数量，那么可以给构造函数传入一个数值，然后 `length` 属性就会被自动创建并设置为这个值。比如，下面的代码会创建一个初始 `length` 为 20 的数组。

```js
let colors = new Array(20);
```

也可以给 `Array` 构造函数传入要保存的元素。

```js
let colors = new Array("red", "blue", "green");
```

创建数组时可以给构造函数传一个值。这时候就有坑了，因为如果这个值是数值，则会创建**一个长度为指定数值**的数组；而如果这个值是其他类型的，则会创建**一个只包含该特定值**的数组。

```js
let colors = new Array(3);     // 创建一个包含 3 个元素的数组 
let names = new Array("Greg"); // 创建一个只包含一个元素，即字符串"Greg"的数组
```

对了，在使用 `Array` 构造函数时，也可以省略 `new` 操作符。结果是一样的。

另一种创建数组的方式是使用数组字面量（array literal）表示法。数组字面量是在中括号中包含以逗号分隔的元素列表。

```js
let colors = ["red", "blue", "green"];  // 创建一个包含 3 个元素的数组 
let names  = [];                        // 创建一个空数组 
let values = [1,2,];                    // 创建一个包含 2 个元素的数组
```

::: tip 注意
与对象一样，在使用数组字面量表示法创建数组不会调用 `Array` 构造函数。
:::

`Array` 构造函数还有两个 ES6 新增的用于创建数组的静态方法：`from()` 和 `of()`。

`from()` 用于将类数组结构转换为数组实例，而 `of()` 用于将一组参数转换为数组实例。

`Array.from()` 的第一个参数是一个类数组对象，即任何可迭代的结构，或者有一个 `length` 属性和可索引元素的结构。

```js
// 字符串会被拆分为单字符数组 
console.log(Array.from("Matt")); // ["M", "a", "t", "t"]  

// 可以使用 from()将集合和映射转换为一个新数组 
const m = new Map().set(1, 2)
    .set(3, 4);
const s = new Set().add(1)
    .add(2)
    .add(3)
    .add(4);

console.log(Array.from(m)); // [[1, 2], [3, 4]] 
console.log(Array.from(s)); // [1, 2, 3, 4] 

// Array.from()对现有数组执行浅复制 
const a1 = [1, 2, 3, 4];
const a2 = Array.from(a1);

console.log(a1);        // [1, 2, 3, 4] 
alert(a1 === a2); // false

// 可以使用任何可迭代对象 
const iter = {
    *[Symbol.iterator]() {
        yield 1;
        yield 2;
        yield 3;
        yield 4;

    }
};
console.log(Array.from(iter)); // [1, 2, 3, 4]

// arguments 对象可以被轻松地转换为数组 
function getArgsArray() {
    return Array.from(arguments);
}
console.log(getArgsArray(1, 2, 3, 4)); // [1, 2, 3, 4] 

// from()也能转换带有必要属性的自定义对象 
const arrayLikeObject = {
    0: 1,
    1: 2,
    2: 3,
    3: 4,
    length: 4
};
console.log(Array.from(arrayLikeObject)); // [1, 2, 3, 4]
```

`Array.from()` 还接收第二个可选的映射函数参数。这个函数可以直接增强新数组的值，而无须像调用 `Array.from().map()` 那样先创建一个中间数组。还可以接收第三个可选参数，用于指定映射函数中 `this` 的值。但这个重写的 `this` 值在箭头函数中不适用。

```js
const a1 = [1, 2, 3, 4]; 
const a2 = Array.from(a1, x => x**2); 
// 此时的this指向的是第三个参数传入的对象
const a3 = Array.from(a1, function(x) {return x**this.exponent}, {exponent: 2}); 
console.log(a2);  // [1, 4, 9, 16] 
console.log(a3);  // [1, 4, 9, 16]
```

`Array.of()` 可以把一组参数转换为数组。这个方法用于替代在 ES6 之前常用的 `Array.prototype.slice.call(arguments)`，一种异常笨拙的将 `arguments` 对象转换为数组的写法。

```js
console.log(Array.of(1, 2, 3, 4)); // [1, 2, 3, 4] 
console.log(Array.of(undefined));  // [undefined]
```